"use strict";(()=>{var f="2.0.0";var w="New Bing Anywhere";var C=()=>location.hostname.includes("google");var k=()=>chrome.i18n.getUILanguage().toLowerCase()==="zh-cn",U=()=>{let e=chrome.i18n.getUILanguage().toLowerCase();return e==="zh-cn"||e==="zh-tw"||e==="zh-hk"||e==="zh"};var b="configV1",p=async()=>({showGoogleButtonOnBing:!0,showBingButtonOnGoogle:!0,showGuideToGithub:!0,showChat:!0,...(await chrome.storage.sync.get(b))[b]}),I=async e=>{let r=await p();await chrome.storage.sync.set({[b]:{...r,...e}})},_=e=>String(e).replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2f;");var u=async(e,r=[])=>await new Promise((n,t)=>{chrome.runtime.sendMessage({method:e,args:[...r]},o=>{!o||o.code!==200?t(o?.msg):n(o.data)})}),D=(()=>{let e="v1";return{get:async r=>{r=`${e}:${r}`;let{data:n,maxAge:t,lastModified:o}=(await chrome.storage.local.get(r))?.[r]??{};return Date.now()-o>t*1e3?(chrome.storage.local.remove(r),null):n},set:async(r,n,t=1/0)=>{r=`${e}:${r}`,await chrome.storage.local.set({[r]:{data:n,lastModified:Date.now(),maxAge:t}})}}})();var y=navigator.userAgent,j=y.includes("Macintosh"),W=y.includes("Firefox"),N=y.includes("Edg/"),H=U(),V=k(),E=!!globalThis.__NBA_isCanary,F=E?`0.${f}`:f;var m=async e=>{try{return await u("openUrlInSameTab",[{url:e}])}catch{location.href=e}},v={attributes:!0,childList:!0,subtree:!0},x=(e,r=document)=>r.querySelector(e),g=async(e,r=30,n=document)=>await new Promise(t=>{let o=x(e,n);if(o){t(o);return}let c=new MutationObserver((s,a)=>{let i=x(e,n);i&&(a.disconnect(),t(i))});c.observe(document,v),setTimeout(()=>{let s=x(e,n);c.disconnect(),t(s)},r*1e3)});var B=async e=>{if(!N){let n=window.document,t=n.createElement("script");t.src=chrome.runtime.getURL("inject.js"),t.onload=t.remove,n.documentElement.appendChild(t)}if(e(()=>{(async()=>{let{showGuideToGithub:n}=await p();if(!n)return;let t=e("#est_switch");e.trim(t.text())==="\u56FD\u5185\u7248\u56FD\u9645\u7248"&&setTimeout(()=>{let o=e('<a href="https://github.com/haozi/New-Bing-Anywhere/issues/8" title="\u67E5\u770B\u5982\u4F55\u6B63\u786E\u914D\u7F6E\u7F51\u7EDC\u4EE3\u7406" target="_blank" rel="noopener noreferrer nofollow">\u4F9D\u7136\u51FA\u73B0\u56FD\u5185\u7248/\u56FD\u9645\u7248\uFF1F</a>').css({color:"#E89ABE",textShadow:"0.5px 0.1px 1px #58070D",fontSize:"12px",fontWeight:"lighter"}).click(()=>{I({showGuideToGithub:!1})});e("#est_switch").append(o).css("width","auto")},2e3)})()}),!location.href.startsWith("https://www.bing.com/search?"))return;let r=await p();g("#sb_form").then(()=>{if(u("getNotification").then(s=>{if(!s)return;let a=e(document.body),i=e("<div/>").css({width:"100%",height:40,border:"1px solid #590727",background:"#58070d",position:"fixed",top:0,fontSize:"12px",lineHeight:"40px",textAlign:"center",zIndex:99999,whiteSpace:"nowrap",textOverflow:"ellipsis",display:"block !important"}),l=()=>{i.remove(),a.css("padding-top",null)},h=e(`<a style="color:#fff; background:url(${chrome.runtime.getURL("images/bing_32x32.png")}) no-repeat left 0; background-size: 12px; padding-left: 20px" href="${s.html_url}" target="_blank" rel="noopener noreferrer nofollow">${s.title}</a>`).on("click",l),d=e('<a href="#" style="background:#58070d; color:#fff; cursor:pointer;padding: 0 68px 0 18px;position: absolute;right:0" title="no reminder">\u2715</a>').on("click",A=>{A.preventDefault(),confirm("Are you sure never see this notice again?")&&u("hideNotification"),l()});i.append(h).append(d),a.append(i).css("padding-top",40)}),e(document.body).on("click","a.b_logoArea",s=>{e(s.currentTarget).attr("href","/").attr("target","_self")}),!r.showGoogleButtonOnBing)return;let n=e("#sb_form_q"),t=n.val(),o=e(`
      <a href="https://www.google.com/search?q=${encodeURIComponent(_(t))}" target="google" tabindex="10" rel="noopener noreferrer nofollow" title="search with Google">
        <img src="${chrome.runtime.getURL("images/google.png")}" alt="google" style="width: 100%;display: block;">
      </a>`).css({position:"absolute",left:0,top:0,width:"70px",height:"23px",display:"inline-block","z-index":999,transition:"all .3s",transform:"translate3d(835px, 13px, 0px)","will-change":"transform",cursor:"pointer"});e("#sb_form").css("position","relative").prepend(o),o.on("click",async s=>{let a=e(s.currentTarget);s.preventDefault();let i="";i||(i=n.val().trim());let l=`https://www.google.com/search?q=${encodeURIComponent(i)}`;a.attr("href",l),await m(l)}),location.search.includes("showconv=1")&&(o.css("display","none"),setTimeout(()=>{o.css("display","inline-block")},1200));let c=()=>{let s=e("#b-scopeListItem-conv"),a=s.hasClass("b_active");if(a){let i=0;s.offset().left?i=s.offset().left+s.width()+30:i=350,o.css({transform:`translate3d(${i}px, 15px, 0)`})}else o.css({transform:"translate3d(835px, 15px, 0)"});!a&&e(".b_searchboxForm").hasClass("as_rsform")&&o.css({transform:"translate3d(1155px, 15px, 0)"})};c(),new MutationObserver((s,a)=>{for(let i of s){let l=i.target;l&&(l.id==="b-scopeListItem-conv"&&c(),l.classList.contains("b_searchboxForm")&&c())}}).observe(document.getElementById("b_header"),v)})};var S=C(),L=async(e,r)=>{let n="";S&&(n=new URLSearchParams(location.search).get("q")??"");let t=chrome.runtime.getURL(`/app/index.html#/chat/iframe?q=${encodeURIComponent(n)}`);try{let o=e(`<iframe src="${t}" scrolling="no" />`);o.css({width:"100%",border:"none",overflow:"hidden",boxSizing:"border-box",willChange:"height",transition:"height .1s cubic-bezier(0, 0, 0, 1.27) 0s",borderRadius:"12px"}),window.addEventListener("message",i=>{let{type:l,data:h}=i.data;if(l!=="nba-resize")return;let{height:d}=h;o.css({height:d})});let c;c=e(await g("#rhs",1)),c.length||(c=e('<div id="rhs" />').css({marginLeft:"var(--rhs-margin)",flex:"0 auto",width:"var(--rhs-width)",position:"relative",paddingBottom:"15px",transition:"opacity 0.3s"}));let s=e(await g(".liYKde.g.VjDLd",.1));s.length?s.prepend(o):c.prepend(o);let a=await g("#center_col");c.insertAfter(a),e(a).after(c)}catch{}};var $=async e=>{(await p()).showBingButtonOnGoogle&&(location.href.startsWith("https://www.google.com/search?")||location.href.startsWith("https://www.google.com.hk/search?"))&&g('[action="/search"]').then(n=>{if(!n)return;let t=e(n),o=t.find('[name="q"]'),c=t.find('button[type="submit"]'),s=e(`
      <a href="https://www.bing.com/search?q=Bing+AI&showconv=1" rel="noopener noreferrer nofollow" target="bing" title="search with New Bing">
        <img src="${chrome.runtime.getURL("images/bing-chat.svg")}" style="display: block; width: 24px;" alt="bing" />
      </a>`).css({width:"40px",display:"flex",position:"relative","z-index":999,cursor:"pointer","justify-content":"center",margin:"0 10px 0 -10px"});c.after(s),s.on("click",async a=>{let i=e(a.currentTarget);a.preventDefault();let l=`https://www.bing.com/search?q=${encodeURIComponent(o.val())}&showconv=1`;i.attr("href",l),await m(l)})})};(async e=>{let r=e(document.documentElement);if(r.find(`meta[name="${w}"]`).length)return;let n=e(`<meta name="${w}" />`);r.prepend(n),u("getEnv").then(t=>{n.attr("content",t.version)}),p().then(t=>{t.showChat&&L(e,t)}),location.hostname==="www.bing.com"&&B(e),location.hostname.startsWith("www.google.")&&$(e)})(window.Zepto);})();
