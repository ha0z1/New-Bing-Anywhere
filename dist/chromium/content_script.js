"use strict";(()=>{var b="2.1.1";var y="New Bing Anywhere (Bing Chat GPT-4)";var B=["google.com","google.com.hk","google.com.tw","google.co.in","google.co.jp","google.de","google.es","google.ru","google.com.sg","google.co.uk","google.co.kr","google.com.vn","google.ws","google.com.tr","google.se","google.to","google.ac","google.ad","google.ae","google.al","google.am","google.as","google.at","google.az","google.ba","google.be","google.bf","google.bg","google.bi","google.bj","google.bs","google.bt","google.by","google.ca","google.cat","google.cd","google.cf","google.cg","google.ch","google.ci","google.cl","google.cm","google.co.ao","google.co.bw","google.co.ck","google.co.cr","google.co.id","google.co.il","google.co.ke","google.co.ls","google.co.ma","google.co.mz","google.co.nz","google.co.th","google.co.tz","google.co.ug","google.co.uz","google.co.ve","google.co.vi","google.co.za","google.co.zm","google.co.zw","google.com.af","google.com.ag","google.com.ai","google.com.ar","google.com.au","google.com.bd","google.com.bh","google.com.bn","google.com.bo","google.com.br","google.com.bz","google.com.co","google.com.cu","google.com.cy","google.com.do","google.com.ec","google.com.eg","google.com.et","google.com.fj","google.com.gh","google.com.gi","google.com.gt","google.com.jm","google.com.kh","google.com.kw","google.com.lb","google.com.lc","google.com.ly","google.com.mm","google.com.mt","google.com.mx","google.com.my","google.com.na","google.com.nf","google.com.ng","google.com.ni","google.com.np","google.com.om","google.com.pa","google.com.pe","google.com.pg","google.com.ph","google.com.pk","google.com.pr","google.com.py","google.com.qa","google.com.sa","google.com.sb","google.com.sl","google.com.sv","google.com.tj","google.com.ua","google.com.uy","google.com.vc","google.cv","google.cz","google.dj","google.dk","google.dm","google.dz","google.ee","google.fi","google.fm","google.fr","google.ga","google.ge","google.gf","google.gg","google.gl","google.gm","google.gp","google.gr","google.gy","google.hn","google.hr","google.ht","google.hu","google.ie","google.im","google.io","google.iq","google.is","google.it","google.je","google.jo","google.kg","google.ki","google.kz","google.la","google.li","google.lk","google.lt","google.lu","google.lv","google.md","google.me","google.mg","google.mk","google.ml","google.mn","google.ms","google.mu","google.mv","google.mw","google.ne","google.nl","google.no","google.nr","google.nu","google.pl","google.pn","google.ps","google.pt","google.ro","google.rs","google.rw","google.sc","google.sh","google.si","google.sk","google.sm","google.sn","google.so","google.sr","google.st","google.td","google.tg","google.tk","google.tl","google.tm","google.tn","google.tt","google.vg","google.vu"];var u=(e=location.hostname)=>B.includes(e.replace(/^www\./,""));var S=()=>{try{return chrome.i18n.getUILanguage().toLowerCase()==="zh-cn"}catch{return!1}},U=()=>{try{let e=chrome.i18n.getUILanguage().toLowerCase();return e==="zh-cn"||e==="zh-tw"||e==="zh-hk"||e==="zh"}catch{return!1}};var x="configV1",l=async()=>({showGoogleButtonOnBing:!0,showBingButtonOnGoogle:!0,showGuideToGithub:!0,showChat:!0,showRelease:!0,triggerMode:"Always",conversationStyle:"Balanced",...(await chrome.storage.sync.get(x))[x]}),N=async e=>{let r=await l();await chrome.storage.sync.set({[x]:{...r,...e}})},I=e=>String(e).replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2f;");var p=async(e,r=[])=>await new Promise((t,o)=>{chrome.runtime.sendMessage({method:e,args:[...r]},g=>{!g||g.code!==200?o(g?.msg):t(g.data)})}),K=(()=>{let e="v1";return{get:async r=>{r=`${e}:${r}`;let{data:t,maxAge:o,lastModified:g}=(await chrome.storage.local.get(r))?.[r]??{};return Date.now()-g>o*1e3?(chrome.storage.local.remove(r),null):t},set:async(r,t,o=1/0)=>{r=`${e}:${r}`,await chrome.storage.local.set({[r]:{data:t,lastModified:Date.now(),maxAge:o}})}}})();var v=navigator.userAgent,E=navigator.userAgentData,V=v.includes("Macintosh"),F=v.includes("Firefox"),A=v.includes("Edg/"),W=E?.brands.findIndex(e=>e.brand==="Brave")>-1,Y=U(),Q=S(),G=!!globalThis.__NBA_isCanary,Z=G?`0.${b}`:b;var h=async e=>{try{return await p("openUrlInSameTab",[{url:e}])}catch{location.href=e}},C={attributes:!0,childList:!0,subtree:!0},T=(e,r=document)=>r.querySelector(e),m=async(e,r=30,t=document)=>await new Promise(o=>{let g=T(e,t);if(g){o(g);return}let c=new MutationObserver((n,s)=>{let i=T(e,t);i&&(s.disconnect(),o(i))});c.observe(document,C),setTimeout(()=>{let n=T(e,t);c.disconnect(),o(n)},r*1e3)});var _=async e=>{if(!A){let t=window.document,o=t.createElement("script");o.src=chrome.runtime.getURL("inject.js"),o.onload=o.remove,t.documentElement.appendChild(o)}if(e(()=>{(async()=>{let{showGuideToGithub:t}=await l();if(!t)return;let o=e("#est_switch");e.trim(o.text())==="\u56FD\u5185\u7248\u56FD\u9645\u7248"&&setTimeout(()=>{let g=e('<a href="https://github.com/haozi/New-Bing-Anywhere/issues/8" title="\u67E5\u770B\u5982\u4F55\u6B63\u786E\u914D\u7F6E\u7F51\u7EDC\u4EE3\u7406" target="_blank" rel="noopener noreferrer nofollow">\u4F9D\u7136\u51FA\u73B0\u56FD\u5185\u7248/\u56FD\u9645\u7248\uFF1F</a>').css({color:"#E89ABE",textShadow:"0.5px 0.1px 1px #58070D",fontSize:"12px",fontWeight:"lighter"}).click(()=>{N({showGuideToGithub:!1})});e("#est_switch").append(g).css("width","auto")},2e3)})()}),!location.href.startsWith("https://www.bing.com/search?"))return;let r=await l();m("#sb_form").then(()=>{if(p("getNotification").then(n=>{if(!n)return;let s=e(document.body),i=e("<div/>").css({width:"100%",height:40,border:"1px solid #590727",background:"#58070d",position:"fixed",top:0,fontSize:"12px",lineHeight:"40px",textAlign:"center",zIndex:99999,whiteSpace:"nowrap",textOverflow:"ellipsis",display:"block !important"}),a=()=>{i.remove(),s.css("padding-top",null)},d=e(`<a style="color:#fff; background:url(${chrome.runtime.getURL("images/bing_32x32.png")}) no-repeat left 0; background-size: 12px; padding-left: 20px" href="${n.html_url}" target="_blank" rel="noopener noreferrer nofollow">${n.title}</a>`).on("click",a),f=e('<a href="#" style="background:#58070d; color:#fff; cursor:pointer;padding: 0 68px 0 18px;position: absolute;right:0" title="no reminder">\u2715</a>').on("click",w=>{w.preventDefault(),confirm("Are you sure never see this notice again?")&&p("hideNotification"),a()});i.append(d).append(f),s.append(i).css("padding-top",40)}),e(document.body).on("click","a.b_logoArea",n=>{e(n.currentTarget).attr("href","/").attr("target","_self")}),!r.showGoogleButtonOnBing)return;let t=e("#sb_form_q"),o=t.val(),g=e(`
      <a href="https://www.google.com/search?q=${encodeURIComponent(I(o))}" target="google" tabindex="10" rel="noopener noreferrer nofollow" title="search with Google">
        <img src="${chrome.runtime.getURL("images/google.png")}" alt="google" style="width: 100%;display: block;">
      </a>`).css({position:"absolute",left:0,top:0,width:"70px",height:"23px",display:"inline-block","z-index":999,transition:"all .3s",transform:"translate3d(835px, 13px, 0px)","will-change":"transform",cursor:"pointer"});e("#sb_form").css("position","relative").prepend(g),g.on("click",async n=>{let s=e(n.currentTarget);n.preventDefault();let i="";i||(i=e.trim(t.val()));let a=`https://www.google.com/search?q=${encodeURIComponent(i)}`;s.attr("href",a),await h(a)}),location.search.includes("showconv=1")&&(g.css("display","none"),setTimeout(()=>{g.css("display","inline-block")},1200));let c=()=>{let n=e("#b-scopeListItem-conv"),s=n.hasClass("b_active");if(s){let i=0;n.offset().left?i=n.offset().left+n.width()+30:i=350,g.css({transform:`translate3d(${i}px, 15px, 0)`})}else g.css({transform:"translate3d(835px, 15px, 0)"});!s&&e(".b_searchboxForm").hasClass("as_rsform")&&g.css({transform:"translate3d(1155px, 15px, 0)"})};c(),new MutationObserver((n,s)=>{for(let i of n){let a=i.target;a&&(a.id==="b-scopeListItem-conv"&&c(),a.classList.contains("b_searchboxForm")&&c())}}).observe(document.getElementById("b_header"),C)})};var P=u(),L=async(e,r)=>{let t="";P&&(t=new URLSearchParams(location.search).get("q")??"");let o=new URLSearchParams(location.hash.slice(1)).get("new-bing-anywhere")??"",g={prompt:t.trim(),extra:o},c=chrome.runtime.getURL(`/app/index.html#/chat/iframe?${new URLSearchParams(g).toString()}`);try{let n=e(`<iframe src="${c}" scrolling="no" />`);n.css({width:"100%",border:"none",overflow:"hidden",boxSizing:"border-box",willChange:"height",transition:"height .1s cubic-bezier(0, 0, 0, 1.27) 0s",borderRadius:"8px"}),window.addEventListener("message",d=>{let{type:f,data:w}=d.data;if(f!=="nba-resize")return;let{height:$}=w;n.css({height:$})});let s;s=e(await m("#rhs",1)),s.length||(s=e('<div id="rhs" />').css({marginLeft:"var(--rhs-margin)",flex:"0 auto",width:"var(--rhs-width)",position:"relative",paddingBottom:"15px",transition:"opacity 0.3s"}));let i=e(await m(".liYKde.g.VjDLd",.1));i.length?i.prepend(n):s.prepend(n);let a=await m("#center_col");s.insertAfter(a),e(a).after(s)}catch{}};var z=async e=>{(await l()).showBingButtonOnGoogle&&location.pathname==="/search"&&m('[action="/search"]').then(t=>{if(!t)return;let o=e(t),g=o.find('[name="q"]'),c=o.find('button[type="submit"]'),n=e(`
      <a href="https://www.bing.com/search?q=Bing+AI&showconv=1" rel="noopener noreferrer nofollow" target="bing" title="search with New Bing">
        <img src="${chrome.runtime.getURL("images/bing-chat.png")}" style="display: block; width: 20px; height: 20px" alt="bing" />
      </a>`).css({width:"40px",display:"flex",position:"relative","z-index":999,cursor:"pointer","justify-content":"center","align-items":"center",margin:"-2px 10px 0 -10px"});c.after(n),n.on("click",async s=>{let i=e(s.currentTarget);s.preventDefault();let a=`https://www.bing.com/search?q=${encodeURIComponent(g.val())}&showconv=1`;i.attr("href",a),await h(a)})})};(async e=>{let r=e(document.documentElement);if(r.find(`meta[name="${y}"]`).length)return;let t=e(`<meta name="${y}" />`);r.prepend(t),p("getEnv").then(o=>{t.attr("content",o.version)}),l().then(o=>{o.showChat&&L(e,o)}),location.hostname==="www.bing.com"&&_(e),u()&&z(e)})(window.Zepto);})();
